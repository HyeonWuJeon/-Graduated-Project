<!doctype html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:sec="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
    <head th:replace="fragments/config :: configFragment" />

    <body>
        <header th:replace="fragments/header :: headerFragment"></header>

        <section>
            <h3 style="padding-top: 50px; padding-left: 130px"><b>질병 정보 그래프</b></h3>

            <div class="container col-lg-12">
                <div class="align-items-center align-content-between">
                    <table id="diseaseTable">
                        <tbody id="diseaseList">
                            <tr th:each="digName : ${diagName}" class="digNameTR" hidden="true">
                                <td th:text="${digName.name}"></td>
                                <td th:text="${digName.count}"></td>
                            </tr>

                            <tr th:each="diName : ${disName}" class="diNameTR" hidden="true">
                                <td th:text="${diName.name}"></td>
                                <td th:text="${diName.count}"></td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="row">
                        <div class="col-lg-6" id="digPieChart" style="width: 900px; height: 500px;"></div>
                        <div class="col-lg-6" id="disPieChart" style="width: 900px; height: 500px;"></div>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <h3 style="padding-top: 30px; padding-left: 130px"><b>동물병원 예약 내역</b></h3>
            <br/>

            <div class="col-md-12">
                <div class="container">
                    <div>
                        <table class="table table-horizontal table-striped table-hover table-bordered">
                            <thead class="thead-strong">
                                <tr>
                                    <th>병원 이름</th>
                                    <th>방문 날짜</th>
                                    <th>병원 주소</th>
                                    <th>병원 번호</th>
                                    <th>예약 내용</th>
                                    <th>회원 이름</th>
                                </tr>
                            </thead>

                            <tbody id="tbody">
                                <tr th:each="reserve : ${reserves}">
                                    <td><a th:href="@{/admin/reserves/settings/{id}(id = ${reserve.id})}" th:text="${reserve.name}"></a></td>
                                    <td th:text="${reserve.date}"></td>
                                    <td th:text="${reserve.address}"></td>
                                    <td th:text="${reserve.tel}"></td>
                                    <td th:text="${reserve.description}"></td>
                                    <td th:text="${reserve.member.getName()}"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
        <script type="text/javascript">
            google.charts.load('current', {'packages':['corechart']});
            google.charts.setOnLoadCallback(drawPieChart);

            function drawPieChart() {

                // let diseaseRows = document.getElementsByTagName("tr");

                let diseaseBody = document.getElementsByTagName("tbody");
                console.log(diseaseBody[0].children[0]);
                console.log(diseaseBody[0].children[1]);
                console.log(diseaseBody[0].children[4]);

                let digNameTR = document.getElementsByClassName("digNameTR");
                console.log("몇 개: " + digNameTR.length);

                console.log(diseaseBody[0].children[0].children[0].textContent);
                console.log(diseaseBody[0].children[0].children[1].textContent);

                let diagName = [];
                let diagCount = [];
                for(let i = 0; i < digNameTR.length; i++) {
                    diagName.push(diseaseBody[0].children[i].children[0].textContent);
                    diagCount.push(parseInt(diseaseBody[0].children[i].children[1].textContent));
                }
                //
                // for(let i = 0; i < diseaseRows.length; i++) {
                //     diseaseType.push(diseaseRows[i].children[0].textContent);
                //     diseaseCount.push(parseInt(diseaseRows[i].children[1].textContent));
                // }

                let diagData = [];
                diagData.push(['진단 질병 이름', '빈도']);

                for(let i = 0; i < digNameTR.length; i++) {
                    let tempData = [];
                    tempData.push(diagName[i]);
                    tempData.push(diagCount[i]);

                    diagData.push(tempData);
                }

                var data = google.visualization.arrayToDataTable(diagData);

                var options = {
                    title: '진단 질병 이름별 정보',
                    slices: {
                        0: { color: 'yellowgreen' },
                        1: { color: 'pink' },
                        2: { color: '#F8EB00' }
                    }
                };

                var chart = new google.visualization.PieChart(document.getElementById('digPieChart'));

                chart.draw(data, options);
            }

            google.charts.load("current", {packages:["corechart"]});
            google.charts.setOnLoadCallback(drawDonutChart);

            function drawDonutChart() {
                let diseaseBody = document.getElementsByTagName("tbody");
                let diNameTR = document.getElementsByClassName("diNameTR");

                let digNameTR = document.getElementsByClassName("digNameTR");
                let diTR = document.getElementsByClassName("diTR");

                let diTRLength = digNameTR.length + diTR.length;

                let diseaseName = [];
                let diseaseCount = [];
                for(let i = diTRLength; i < diTRLength + diNameTR.length; i++) {
                    diseaseName.push(diseaseBody[0].children[i].children[0].textContent);
                    diseaseCount.push(parseInt(diseaseBody[0].children[i].children[1].textContent));
                }

                let diseaseData = [];
                diseaseData.push(['질병 이름', '빈도']);

                console.log(diseaseName);
                console.log(diseaseCount);

                for(let i = 0; i < diNameTR.length; i++) {
                    let tempData = [];
                    tempData.push(diseaseName[i]);
                    tempData.push(diseaseCount[i]);

                    diseaseData.push(tempData);
                }

                console.log(diseaseData);

                var data = google.visualization.arrayToDataTable(diseaseData);

                var options = {
                    title: '전체 질병 이름별 정보'
                };

                var chart = new google.visualization.PieChart(document.getElementById('disPieChart'));
                chart.draw(data, options);
            }
        </script>

        <footer th:replace="fragments/footer :: footerFragment"></footer>
    </body>
</html>